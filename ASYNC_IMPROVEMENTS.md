# üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —É–ª—É—á—à–µ–Ω–æ

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω Enhanced SoundCloud**
- **–ü—Ä–æ–±–ª–µ–º–∞**: Enhanced SoundCloud –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∫–ª–∞—Å—Å —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–æ–º `search_urls`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç slowed/remix –≤–µ—Ä—Å–∏–∏

### 2. **–£–ª—É—á—à–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è SoundCloud Fallback**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û–±—ã—á–Ω—ã–π SoundCloud –Ω–∞—Ö–æ–¥–∏–ª slowed –≤–µ—Ä—Å–∏–∏ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º
- **–ê–ª–≥–æ—Ä–∏—Ç–º**:
  1. –ü–æ–ª—É—á–∞–µ–º 5 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
  2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —á–µ—Ä–µ–∑ yt-dlp (extract_flat)
  3. –§–∏–ª—å—Ç—Ä—É–µ–º —á–µ—Ä–µ–∑ `ImprovedSearchEngine`
  4. –°–∫–∞—á–∏–≤–∞–µ–º –ª—É—á—à–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞

### 3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω —Å–µ–º–∞—Ñ–æ—Ä –∏ —Å—á–µ—Ç—á–∏–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –ú–∞–∫—Å–∏–º—É–º 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: 
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
  - –õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°–µ–º–∞—Ñ–æ—Ä –∏ —Å—á–µ—Ç—á–∏–∫–∏:
```python
# –°–µ–º–∞—Ñ–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
download_semaphore = asyncio.Semaphore(3)
active_downloads = 0
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤:
```python
async def process_track(message, track_id, processing_msg):
    global active_downloads
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
    if active_downloads >= 3:
        await processing_msg.edit_text("‚è≥ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ")
        return
    
    active_downloads += 1
    
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ–º–∞—Ñ–æ—Ä
        async with download_semaphore:
            file_path = await MusicDownloader.search_and_download(query, track_info)
    finally:
        active_downloads -= 1
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è SoundCloud:
```python
# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
candidate_info = []
for url in sc_urls:
    with yt_dlp.YoutubeDL(ydl_info_opts) as ydl_info:
        info = ydl_info.extract_info(url, download=False)
        candidate_info.append({
            'url': url,
            'title': info.get('title', ''),
            'duration': info.get('duration', 0),
            'view_count': info.get('view_count', 0)
        })

# –§–∏–ª—å—Ç—Ä—É–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
filtered_candidates = ImprovedSearchEngine.filter_original_versions(candidate_info, track_info)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå Enhanced SoundCloud –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
- ‚ùå SoundCloud –Ω–∞—Ö–æ–¥–∏–ª slowed –≤–µ—Ä—Å–∏–∏
- ‚ùå –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ **Enhanced SoundCloud —Ä–∞–±–æ—Ç–∞–µ—Ç** - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≤–µ—Ä—Å–∏–∏
- ‚úÖ **SoundCloud Fallback —É–º–Ω—ã–π** - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –¥–æ 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏** - —Å–µ–º–∞—Ñ–æ—Ä –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É
- ‚úÖ **–õ—É—á—à–∏–π UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–æ–∫

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ó–∞–ø—Ä–æ—Å: "Pentagram - Slowed escorte"

**–î–æ**: –ù–∞—Ö–æ–¥–∏–ª "ESCORTE - PENTAGRAM (SUPER SLOWED + REVERB)" ‚ùå

**–ü–æ—Å–ª–µ**: 
1. Enhanced SoundCloud –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
2. –§–∏–ª—å—Ç—Ä—É–µ—Ç slowed –≤–µ—Ä—Å–∏–∏ (-30 –æ—á–∫–æ–≤)
3. –í—ã–±–∏—Ä–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
4. –°–∫–∞—á–∏–≤–∞–µ—Ç –ª—É—á—à–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ ‚úÖ

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1**: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫ ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ 1/3
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2**: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫ ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ 2/3  
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 3**: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫ ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ 3/3
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 4**: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫ ‚Üí "‚è≥ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ"

## üöÄ –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### `/status` - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
```
ü§ñ –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞

üîÑ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: 2/3
üéµ FFmpeg –¥–æ—Å—Ç—É–ø–µ–Ω: ‚úÖ
üéß Spotify API: ‚úÖ
üåê –ü—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: 25+

üí° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ Spotify —Å—Å—ã–ª–∫–∞–º
‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ç—Ä–µ–∫–∞
‚Ä¢ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
‚Ä¢ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
‚Ä¢ 25+ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –º—É–∑—ã–∫–∏
```

## üîç –õ–æ–≥–∏ —É–ª—É—á—à–µ–Ω–∏–π

### Enhanced SoundCloud:
```
2025-10-19 21:20:39 - INFO - Provider: Enhanced SoundCloud
2025-10-19 21:20:40 - INFO - Enhanced SoundCloud: Best candidate 'Pentagram - Original Version'
2025-10-19 21:20:45 - INFO - Enhanced SoundCloud success: downloads/Pentagram - Original Version.mp3
```

### SoundCloud Fallback —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π:
```
2025-10-19 21:20:46 - INFO - Provider: SoundCloud Fallback
2025-10-19 21:20:46 - INFO - SoundCloud candidates: 5
2025-10-19 21:20:47 - INFO - SoundCloud Fallback: Best candidate 'Pentagram - Official'
2025-10-19 21:20:50 - INFO - SoundCloud success: downloads/Pentagram - Official.mp3
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
```
2025-10-19 21:20:45 - INFO - –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: 1
2025-10-19 21:20:46 - INFO - –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: 2
2025-10-19 21:20:47 - INFO - –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: 3
2025-10-19 21:20:48 - INFO - ‚è≥ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

## üéâ –ò—Ç–æ–≥

**–¢–µ–ø–µ—Ä—å –±–æ—Ç:**
- ‚úÖ **–ù–∞—Ö–æ–¥–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏** –≤–º–µ—Å—Ç–æ slowed/remix
- ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** - –¥–æ 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏** - —Å–µ–º–∞—Ñ–æ—Ä –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É
- ‚úÖ **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å** - –∫–æ–º–∞–Ω–¥–∞ `/status`
- ‚úÖ **–£–º–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç** - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç:**
- üéµ **–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏** –≤–º–µ—Å—Ç–æ slowed –≤–µ—Ä—Å–∏–π
- ‚ö° **–ë—ã—Å—Ç—Ä—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º—É
- üìä **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–æ–∫
- üõ°Ô∏è **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** –±–ª–∞–≥–æ–¥–∞—Ä—è –∑–∞—â–∏—Ç–µ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
